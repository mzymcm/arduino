sudo dpkg --configure -a --force-all
sudo apt update && sudo apt upgrade
sudo aid-python3 -m pip install --upgrade pip
===ç‚¹åº”ç”¨å¸‚åœºï¼Œç‚¹AidLuxï¼Œå®‰è£…Aid-Pkgï¼Œæ›´æ–°Terminalå’ŒAid-Desktop
===ç‚¹åº”ç”¨å¸‚åœºï¼Œç‚¹Ubuntu,æœç´¢xfce4 å®‰è£…
===ç‚¹åº”ç”¨å¸‚åœºï¼Œç‚¹AidLux,å®‰è£…Ubuntu Desktop
sudo apt-get install nano
sudo apt-get install xterm
cd /opt/aidlux/app/ubuntu-desktop
sudo cp vncserver.sh vncserver.sh_back
sudo cp start-xwayland.sh start-xwayland.sh_back
sudo ./vncserver.sh start

====å¦‚æœå‡ºé”™ï¼š

cat > /root/.vnc/xstartup << 'EOF'
#!/bin/bash
unset DBUS_SESSION_BUS_ADDRESS
unset SESSION_MANAGER
export XDG_CURRENT_DESKTOP=XFCE
xrdb "$HOME/.Xresources"
startxfce4 &
EOF
chmod +x /root/.vnc/xstartup

===æ‰“å¼€ vncserver.sh æ‰¾åˆ°  export XDG_CURRENT_DESKTOP=ubuntu:GNOME æ”¹ä¸ºä¸‹é¢çš„è®¾ç½®ä¿å­˜
export XDG_CURRENT_DESKTOP=ubuntu:XFCE

å¦‚æœæƒ³å†ä¼˜åŒ–ä¸€ä¸‹ï¼Œå°†è¿™ä¸ªä¹Ÿæ”¹ä¸€ä¸‹ï¼š tigervncserver -localhost no :2 æ”¹ä¸ºä¸‹é¢çš„ã€‚
sudo /usr/bin/tigervncserver :2 -geometry 1280x768 -localhost no





========æˆ‘è¿™é‡Œç»™å‡ºä¸€ä¸ªæ›´ä¸ºå¥½çš„æ–¹æ¡ˆï¼Œç›´æ¥ç”¨æˆ‘å·²æ”¹å¥½çš„è„šæœ¬  vncserver.sh



==== vncserver.sh æ–‡ä»¶å†…å®¹  å¼€å§‹====


#!/bin/bash

APP_HOME="/opt/aidlux/app/ubuntu-desktop"
PROCESS_NAME="Xtigervnc"
USER_NAME="aidlux"
USER_HOME="/home/$USER_NAME"
cd "$USER_HOME"

# è·å–æ­£ç¡®çš„ IP åœ°å€ï¼ˆä¼˜å…ˆ wlan0ï¼‰
function get_ip() {
    # å°è¯•è·å– wlan0 IP
    local wlan_ip=$(ip -4 addr show wlan0 2>/dev/null | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | head -1)
    
    if [[ -n "$wlan_ip" ]]; then
        echo "$wlan_ip"
        return 0
    fi
    
    # å°è¯•è·å– eth0 IP
    local eth_ip=$(ip -4 addr show eth0 2>/dev/null | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | head -1)
    
    if [[ -n "$eth_ip" ]]; then
        echo "$eth_ip"
        return 0
    fi
    
    # è·å–ç¬¬ä¸€ä¸ªéæœ¬åœ° IP
    local first_ip=$(hostname -I 2>/dev/null | awk '{print $1}')
    
    if [[ -n "$first_ip" ]]; then
        echo "$first_ip"
        return 0
    fi
    
    # å›é€€åˆ° localhost
    echo "127.0.0.1"
}

function start() {
    local pid=$(ps -ef | grep -v grep | grep -v "${PROCESS_NAME}.sh" | grep -v tail | grep "${PROCESS_NAME}.*:2" | awk '{print $2}')
    if [[ -n ${pid} ]]; then
        echo "VNC æœåŠ¡å™¨å·²ç»åœ¨è¿è¡Œï¼Œè¿›ç¨‹ ID: ${pid}"
        show_connection_info
        exit 0
    fi

    # æ¸…ç†é”æ–‡ä»¶
    if [[ -e "/tmp/.X2-lock" ]]; then
        rm -rf /tmp/.X2-lock
    fi
    if [[ -e "/tmp/.X11-unix/X2" ]]; then
        rm -rf /tmp/.X11-unix/X2
    fi

    # åœæ­¢å¯èƒ½å­˜åœ¨çš„ VNC ä¼šè¯
    sudo -u "$USER_NAME" vncserver -kill :2 2>/dev/null || true
    
    # è®¾ç½®ç¯å¢ƒå˜é‡
    export XKL_XMODMAP_DISABLE=1
    export XDG_CONFIG_DIRS=/etc/xdg/xdg-ubuntu:/etc/xdg
    export GNOME_SHELL_SESSION_MODE=ubuntu
    export XDG_CURRENT_DESKTOP=XFCE
    export XDG_SESSION_TYPE=x11
    export DISPLAY=:2
    
    # æ³¨æ„ï¼šAidlux å¯èƒ½æ²¡æœ‰ systemdï¼Œæ‰€ä»¥ç§»é™¤ systemctl å‘½ä»¤
    # å°è¯•åœæ­¢å¯èƒ½çš„æ˜¾ç¤ºç®¡ç†å™¨ï¼ˆä¸ä½¿ç”¨ systemctlï¼‰
    pkill -f gdm 2>/dev/null || true
    pkill -f lightdm 2>/dev/null || true
    sleep 2

    # åˆ›å»º xstartup æ–‡ä»¶
    create_xstartup
    
    # ä»¥ aidlux ç”¨æˆ·å¯åŠ¨ VNC æœåŠ¡å™¨
    echo "æ­£åœ¨å¯åŠ¨ VNC æœåŠ¡å™¨..."
    sudo -u "$USER_NAME" /usr/bin/tigervncserver :2 -geometry 1280x768 -localhost no
    
    sleep 3

    # é‡æ–°æ£€æŸ¥è¿›ç¨‹
    pid=$(ps -ef | grep -v grep | grep -v "${PROCESS_NAME}.sh" | grep -v tail | grep "${PROCESS_NAME}.*:2" | awk '{print $2}')

    if [[ -z "${pid}" ]]; then
        # ç­‰å¾…è¿›ç¨‹å¯åŠ¨
        local count=0
        while ((count < 10)); do
            pid=$(ps -ef | grep -v grep | grep -v "${PROCESS_NAME}.sh" | grep -v tail | grep "${PROCESS_NAME}.*:2" | awk '{print $2}')
            if [[ -n ${pid} ]]; then
                echo "âœ… VNC æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œè¿›ç¨‹ ID: ${pid}"
                show_connection_info
                break
            fi
            ((count++))
            sleep 1
        done
        
        if [[ -z "${pid}" ]]; then
            echo "âŒ VNC æœåŠ¡å™¨å¯åŠ¨å¤±è´¥"
            echo "è¯·æ£€æŸ¥æ—¥å¿—: tail -20 /home/${USER_NAME}/.vnc/localhost:2.log"
            return 1
        fi
    else
        echo "âœ… VNC æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œè¿›ç¨‹ ID: ${pid}"
        show_connection_info
    fi
}

function create_xstartup() {
    local xstartup="/home/${USER_NAME}/.vnc/xstartup"
    
    echo "åˆ›å»º xstartup æ–‡ä»¶..."
    
    sudo -u "$USER_NAME" cat > "$xstartup" << 'EOF'
#!/bin/bash
# XFCE æ¡Œé¢ç¯å¢ƒé…ç½®

# æ¸…ç†ç¯å¢ƒå˜é‡
unset SESSION_MANAGER
unset DBUS_SESSION_BUS_ADDRESS

# è®¾ç½®æ˜¾ç¤º
export DISPLAY=:2

# è®¾ç½®æ¡Œé¢ç¯å¢ƒå˜é‡
export XDG_SESSION_TYPE=x11
export XDG_CURRENT_DESKTOP=XFCE
export XDG_SESSION_DESKTOP=xfce
export XDG_CONFIG_DIRS=/etc/xdg/xdg-xfce:/etc/xdg
export XDG_DATA_DIRS=/usr/share/xfce4:/usr/local/share:/usr/share

# å¯åŠ¨ XFCE ä¼šè¯
if [ -x /usr/bin/xfce4-session ]; then
    exec /usr/bin/xfce4-session
else
    # å¤‡ç”¨æ–¹æ¡ˆï¼šå¯åŠ¨ xterm
    xterm -geometry 80x24+10+10 -ls &
    wait
fi
EOF
    
    sudo -u "$USER_NAME" chmod +x "$xstartup"
    echo "xstartup æ–‡ä»¶å·²åˆ›å»º"
}

function stop() {
    echo "æ­£åœ¨åœæ­¢ VNC æœåŠ¡å™¨..."
    
    local count=0
    local pid=$(ps -ef | grep -v grep | grep -v "${PROCESS_NAME}.sh" | grep -v tail | grep "${PROCESS_NAME}.*:2" | awk '{print $2}')
    
    if [[ -n ${pid} ]]; then
        echo "æ‰¾åˆ° VNC è¿›ç¨‹: ${pid}"
        
        # å…ˆå°è¯•æ­£å¸¸åœæ­¢ VNC ä¼šè¯
        sudo -u "$USER_NAME" vncserver -kill :2 2>/dev/null || true
        
        # ç­‰å¾…è¿›ç¨‹ç»“æŸ
        while kill -0 ${pid} >/dev/null 2>&1; do
            if ((count >= 10)); then
                kill -9 ${pid} 2>/dev/null || true
                echo "å¼ºåˆ¶ç»ˆæ­¢è¿›ç¨‹: ${pid}"
                break
            fi
            ((count++))
            sleep 1
        done
        
        # åœæ­¢å¯èƒ½çš„æ¡Œé¢è¿›ç¨‹
        sudo -u "$USER_NAME" pkill -f xfce4-session 2>/dev/null || true
        sudo -u "$USER_NAME" pkill -f gnome-session 2>/dev/null || true
        
        # æ³¨æ„ï¼šAidlux å¯èƒ½æ²¡æœ‰ systemdï¼Œæ‰€ä»¥ç§»é™¤ systemctl å‘½ä»¤
        # å°è¯•å¯åŠ¨å¯èƒ½çš„æ˜¾ç¤ºç®¡ç†å™¨
        echo "å°è¯•å¯åŠ¨æ˜¾ç¤ºç®¡ç†å™¨..."
    fi

    # æ¸…ç†é”æ–‡ä»¶
    rm -f /tmp/.X2-lock 2>/dev/null
    rm -f /tmp/.X11-unix/X2 2>/dev/null

    echo "âœ… VNC æœåŠ¡å™¨å·²åœæ­¢"
}

function restart() {
    echo "æ­£åœ¨é‡å¯ VNC æœåŠ¡å™¨..."
    stop
    echo "ç­‰å¾…èµ„æºé‡Šæ”¾..."
    sleep 5
    start
}

function status() {
    local pid=$(ps -ef | grep -v grep | grep -v "${PROCESS_NAME}.sh" | grep -v tail | grep "${PROCESS_NAME}.*:2" | awk '{print $2}')
    
    if [[ -n "${pid}" ]]; then
        echo "âœ… VNC æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ"
        echo "è¿›ç¨‹ ID: ${pid}"
        
        # æ£€æŸ¥ç«¯å£
        if ss -tuln 2>/dev/null | grep -q ":5902"; then
            echo "ç«¯å£çŠ¶æ€: 5902 ç«¯å£æ­£åœ¨ç›‘å¬"
        else
            echo "ç«¯å£çŠ¶æ€: 5902 ç«¯å£æœªç›‘å¬ï¼ˆå¯èƒ½ä»åœ¨å¯åŠ¨ä¸­ï¼‰"
        fi
        
        show_connection_info
        return 0
    else
        echo "âŒ VNC æœåŠ¡å™¨æœªè¿è¡Œ"
        echo "ä½¿ç”¨ '$0 start' å¯åŠ¨ VNC æœåŠ¡å™¨"
        return 1
    fi
}

function show_connection_info() {
    local ip=$(get_ip)
    
    echo ""
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ğŸ–¥ï¸  VNC æœåŠ¡å™¨è¿æ¥ä¿¡æ¯"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    echo "ğŸ“¡ ç½‘ç»œè¿æ¥:"
    echo "   æœ¬åœ°è¿æ¥:    localhost:2 æˆ– 127.0.0.1:5902"
    echo "   è¿œç¨‹è¿æ¥:    ${ip}:5902"
    echo ""
    echo "ğŸš€ è¿æ¥å‘½ä»¤:"
    echo "   xtigervncviewer localhost:2"
    echo "   æˆ–"
    echo "   xtigervncviewer ${ip}:5902"
    echo ""
    echo "ğŸ”‘ å¯†ç : ä½¿ç”¨ä¹‹å‰è®¾ç½®çš„ VNC å¯†ç "
    if [[ ! -f "/home/${USER_NAME}/.vnc/passwd" ]]; then
        echo "âš ï¸  è­¦å‘Š: æœªè®¾ç½® VNC å¯†ç "
        echo "   è®¾ç½®å¯†ç : sudo -u aidlux vncpasswd"
    fi
    echo ""
    echo "ğŸ“‹ æ•…éšœæ’é™¤:"
    echo "   æŸ¥çœ‹æ—¥å¿—: tail -20 /home/${USER_NAME}/.vnc/localhost:2.log"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
}

function main() {
    local param=""
    while (($# > 0)); do
        param=$1
        case ${param} in
        "start")
            start
            exit $?
            ;;
        "restart")
            restart
            exit $?
            ;;
        "stop")
            stop
            exit $?
            ;;
        "status")
            status
            exit $?
            ;;
        "info")
            show_connection_info
            exit $?
            ;;
        *)
            echo "ç”¨æ³•: $0 <start|stop|restart|status|info>"
            exit 1
            ;;
        esac
    done
}

if (($# <= 0 || $# > 2)); then
    echo "ç”¨æ³•: $0 <start|stop|restart|status|info>"
    echo ""
    echo "å‘½ä»¤è¯´æ˜:"
    echo "  start    - å¯åŠ¨ VNC æœåŠ¡å™¨ (XFCE æ¡Œé¢)"
    echo "  stop     - åœæ­¢ VNC æœåŠ¡å™¨"
    echo "  restart  - é‡å¯ VNC æœåŠ¡å™¨"
    echo "  status   - æŸ¥çœ‹ VNC æœåŠ¡å™¨çŠ¶æ€"
    echo "  info     - æ˜¾ç¤ºè¿æ¥ä¿¡æ¯"
    exit 1
fi

main "$@"

exit 0



==== vncserver.sh æ–‡ä»¶å†…å®¹  ç»“æŸ====








===å¦‚æœæ‰‹æœºç«¯çš„ xwayland æ‰“ä¸å¼€ xfce4 ï¼šæ‰“å¼€ start-xwayland.sh å°†ä¸‹é¢çš„ä»£ç æ¢ä¸Šå³å¯ã€‚
sudo nano start-xwayland.sh
==== start-xwayland.sh æ–‡ä»¶å†…å®¹  å¼€å§‹====
#!/bin/bash
# åˆ¤æ–­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦ç­‰äº "basic"
if [ "$1" = "basic" ]; then
    pkill -f gnome-session
    sleep 4
    service dbus start
    service dbus start
    export DISPLAY=:1
    export XKL_XMODMAP_DISABLE=1
    export XDG_CONFIG_DIRS=/etc/xdg/xdg-ubuntu:/etc/xdg 
    export GNOME_SHELL_SESSION_MODE=ubuntu 
    export XDG_CURRENT_DESKTOP=ubuntu:GNOME 
    export XDG_SESSION_TYPE=x11 
    gnome-shell --x11
    echo "The flavor is 'basic'."
else
    cd /home/aidlux
    systemctl start gdm
    if [[ -f "/usr/local/bin/aidluxctl" ]]; then
      /usr/local/bin/aidluxctl start
    fi
    
    if [[ -f "/usr/local/bin/launch-gm" ]]; then
      export XKL_XMODMAP_DISABLE=1
      export XDG_CONFIG_DIRS=/etc/xdg/xdg-ubuntu:/etc/xdg
      export GNOME_SHELL_SESSION_MODE=ubuntu
      export XDG_CURRENT_DESKTOP=ubuntu:GNOME
      export XDG_SESSION_TYPE=x11
      env DISPLAY=:1 gnome-session >/dev/null 2>&1 &
      /usr/local/bin/launch-gm
    else
      start-xwayland-gnome
    fi
fi
start-xwayland-xfce4

==== start-xwayland.sh æ–‡ä»¶å†…å®¹  ç»“æŸ====







======= XFCE4è®¾ç½®ä¸­æ–‡ç•Œé¢
â€Œsudo apt update && sudo apt install language-pack-zh-hans
sudo dpkg-reconfigure locales
é€‰ä¸­zh_CN.UTF-8 UTF-8
sudo apt install fonts-wqy-zenhei
é‡å¯åç™»å½•ç•Œé¢å’Œæ¡Œé¢åº”æ˜¾ç¤ºä¸ºä¸­æ–‡


======= ä¸‹é¢çš„ä¸ç”¨ç®¡ï¼Œæ˜¯ä¸´æ—¶ä¿®æ”¹ç”¨çš„ã€‚
sudo rm ./vncserver.sh
sudo nano vncserver.sh
sudo chmod 0755 vncserver.sh
sudo ./vncserver.sh start
sudo cp vncserver.sh_back vncserver.sh
sudo rm ./start-xwayland.sh
sudo nano start-xwayland.sh
sudo chmod 0755 start-xwayland.sh


æ¶ˆé™¤è­¦å‘Šï¼Œå¯ä»¥ç»™è¿™äº›GIDåˆ†é…ç»„å

# ä¸º1079 GIDåˆ›å»ºç»„å
echo "aid_1079:x:1079:" >> /etc/group

# ä¸º99909997 GIDåˆ›å»ºç»„å
echo "aid_app:x:99909997:" >> /etc/group


=====å®‰è£…midoriæµè§ˆå™¨ è§£å†³firefoxæµè§ˆå™¨ä½¿ç”¨é—®é¢˜
sudo apt install midori
midori

=====æ¸…é™¤å‘½ä»¤çª—å£çš„å‘½ä»¤ç¼“å­˜
echo "" > ~/.bash_history



===== æ³¢ç‰¹å¾‹åŠ¨ç½‘ç«™stm32å­¦ä¹ 
https://www.baud-dance.com/

===== åœ¨çº¿å·¥å…· ä¸²å£åŠ©æ‰‹ ğŸ”—
https://serial.baud-dance.com/
===== åœ¨çº¿å·¥å…· OLEDå–æ¨¡åŠ©æ‰‹ ğŸ”—
https://led.baud-dance.com/
===== ç«™é•¿å·¥å…·ç½‘ç«™
https://tool.chinaz.com/tools/nav
===== SQLä¼˜åŒ–å™¨
https://ai.chinaz.com/encoder/sql-optimiser