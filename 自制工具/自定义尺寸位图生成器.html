<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªå®šä¹‰å°ºå¯¸ä½å›¾ç”Ÿæˆå™¨</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.92);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #2c3e50, #4a6491);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .description {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            padding: 25px;
        }
        
        .upload-section {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-right: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        
        .preview-section {
            flex: 2;
            min-width: 300px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 30px 20px;
            text-align: center;
            background-color: #e8f4fc;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        
        .upload-area:hover {
            background-color: #d4edfd;
            border-color: #2980b9;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .dimension-group {
            display: flex;
            gap: 10px;
        }
        
        .dimension-group input {
            flex: 1;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .checkbox-group input {
            margin-right: 10px;
        }
        
        .btn {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-convert {
            background: #2ecc71;
        }
        
        .btn-convert:hover {
            background: #27ae60;
        }
        
        .btn-copy {
            background: #9b59b6;
        }
        
        .btn-copy:hover {
            background: #8e44ad;
        }
        
        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .image-preview {
            flex: 1;
            min-width: 200px;
            text-align: center;
        }
        
        .image-preview img, .image-preview canvas {
            max-width: 100%;
            max-height: 300px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .hex-output {
            flex: 2;
            min-width: 300px;
        }
        
        textarea {
            width: 100%;
            height: 400px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
            background-color: #f9f9f9;
            line-height: 1.4;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
            gap: 10px;
        }
        
        .info {
            margin-top: 25px;
            padding: 15px;
            background: #e8f4fc;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .info h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .info ul {
            padding-left: 20px;
        }
        
        .info li {
            margin-bottom: 8px;
        }
        
        .byte-info {
            margin-top: 15px;
            padding: 10px;
            background: #d4edda;
            border-radius: 4px;
            border-left: 4px solid #28a745;
            font-weight: bold;
        }
        
        .resize-notice {
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 4px;
            border-left: 4px solid #ffc107;
            font-size: 0.9rem;
        }
        
        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .preset-btn {
            padding: 6px 12px;
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .preset-btn:hover {
            background: #d4edfd;
            border-color: #3498db;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .upload-section, .preview-section {
                margin-right: 0;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>è‡ªå®šä¹‰å°ºå¯¸ä½å›¾ç”Ÿæˆå™¨</h1>
            <p class="description">ä¸Šä¼ å›¾ç‰‡ï¼Œè‡ªå®šä¹‰å°ºå¯¸å¹¶ç”Ÿæˆé€‚ç”¨äºArduino/OLEDçš„å®Œæ•´ä»£ç </p>
        </header>
        
        <div class="content">
            <div class="upload-section">
                <h2 class="section-title">ä¸Šä¼ ä¸è®¾ç½®</h2>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“</div>
                    <p>ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œ</p>
                    <p class="small">æ”¯æŒ JPG, PNG, BMP æ ¼å¼</p>
                </div>
                <input type="file" id="fileInput" class="file-input" accept="image/*">
                
                <div class="input-group">
                    <label for="arrayName">æ•°ç»„åç§°:</label>
                    <input type="text" id="arrayName" value="MY_BITMAP" placeholder="è¾“å…¥æ•°ç»„åç§°">
                </div>
                
                <div class="input-group">
                    <label for="bitmapWidth">ä½å›¾å®½åº¦ (åƒç´ ):</label>
                    <input type="number" id="bitmapWidth" value="64" min="1" max="512">
                </div>
                
                <div class="input-group">
                    <label for="bitmapHeight">ä½å›¾é«˜åº¦ (åƒç´ ):</label>
                    <input type="number" id="bitmapHeight" value="64" min="1" max="512">
                </div>
                
                <div class="preset-buttons">
                    <button class="preset-btn" data-width="32" data-height="32">32Ã—32</button>
                    <button class="preset-btn" data-width="64" data-height="32">64Ã—32</button>
                    <button class="preset-btn" data-width="64" data-height="64">64Ã—64</button>
                    <button class="preset-btn" data-width="128" data-height="64">128Ã—64</button>
                    <button class="preset-btn" data-width="128" data-height="128">128Ã—128</button>
                </div>
                
                <div class="input-group">
                    <label for="bytesPerRow">æ¯è¡Œå­—èŠ‚æ•°:</label>
                    <input type="number" id="bytesPerRow" value="16" min="1" max="32">
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="invertColors">
                    <label for="invertColors">åè½¬é¢œè‰²</label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="outputFullCode" checked>
                    <label for="outputFullCode">è¾“å‡ºå®Œæ•´Arduinoä»£ç </label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="keepAspectRatio" checked>
                    <label for="keepAspectRatio">ä¿æŒå®½é«˜æ¯”</label>
                </div>
                
                <div class="resize-notice">
                    <strong>æ³¨æ„:</strong> å›¾ç‰‡å°†è‡ªåŠ¨è°ƒæ•´ä¸ºæŒ‡å®šå°ºå¯¸
                </div>
                
                <div class="controls">
                    <button class="btn btn-convert" id="convertBtn">ç”Ÿæˆä»£ç </button>
                    <button class="btn" id="resetBtn">é‡ç½®</button>
                </div>
            </div>
            
            <div class="preview-section">
                <h2 class="section-title">é¢„è§ˆä¸è¾“å‡º</h2>
                <div class="preview-container">
                    <div class="image-preview">
                        <h3>åŸå§‹å›¾ç‰‡</h3>
                        <canvas id="originalCanvas"></canvas>
                        <div id="originalSize"></div>
                    </div>
                    <div class="image-preview">
                        <h3>è‡ªå®šä¹‰å°ºå¯¸ä½å›¾</h3>
                        <canvas id="customCanvas"></canvas>
                        <div id="customSize"></div>
                    </div>
                </div>
                
                <div class="hex-output">
                    <h3>è¾“å‡ºä»£ç </h3>
                    <textarea id="hexOutput" placeholder="ç”Ÿæˆçš„ä»£ç å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..." readonly></textarea>
                    <div id="byteInfo" class="byte-info"></div>
                    <div class="controls">
                        <button class="btn btn-copy" id="copyBtn">å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
                        <button class="btn" id="downloadBtn">ä¸‹è½½ä¸º.inoæ–‡ä»¶</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="info">
            <h3>ä½¿ç”¨è¯´æ˜</h3>
            <ul>
                <li>ä¸Šä¼ é»‘ç™½å›¾ç‰‡æˆ–å½©è‰²å›¾ç‰‡ï¼ˆå½©è‰²å›¾ç‰‡å°†è‡ªåŠ¨è½¬æ¢ä¸ºé»‘ç™½ï¼‰</li>
                <li>è®¾ç½®ä½å›¾çš„å®½åº¦å’Œé«˜åº¦ï¼Œæˆ–ä½¿ç”¨é¢„è®¾å°ºå¯¸</li>
                <li>è®¾ç½®æ•°ç»„åç§°å’Œæ¯è¡Œå­—èŠ‚æ•°ï¼ˆé€šå¸¸ä¸º8ã€16æˆ–32ï¼‰</li>
                <li>å‹¾é€‰"åè½¬é¢œè‰²"å¯ä»¥äº¤æ¢é»‘ç™½åƒç´ </li>
                <li>å‹¾é€‰"ä¿æŒå®½é«˜æ¯”"å¯ä»¥é˜²æ­¢å›¾ç‰‡å˜å½¢</li>
                <li>å‹¾é€‰"è¾“å‡ºå®Œæ•´Arduinoä»£ç "å¯ä»¥ç”ŸæˆåŒ…å«å¤´æ–‡ä»¶å’Œsetup/loopå‡½æ•°çš„å®Œæ•´ä»£ç </li>
                <li>ç‚¹å‡»"ç”Ÿæˆä»£ç "æŒ‰é’®ç”ŸæˆArduino/OLEDå…¼å®¹çš„ä½å›¾ä»£ç </li>
                <li>ç”Ÿæˆçš„æ•°ç»„æ ¼å¼ä¸ºï¼šstatic unsigned char arrayName[] PROGMEM = { ... };</li>
                <li>æ¯è¡Œæœ«å°¾æœ‰é€—å·ï¼Œæœ€åä¸€è¡Œæ²¡æœ‰é€—å·</li>
                <li>å­—èŠ‚å¤§å°ä¿¡æ¯ä¼šæ˜¾ç¤ºåœ¨è¾“å‡ºåŒºåŸŸï¼Œæ–¹ä¾¿åœ¨oled.drawBitmap()ä¸­ä½¿ç”¨</li>
                <li>ç‚¹å‡»"å¤åˆ¶åˆ°å‰ªè´´æ¿"å¯ä»¥å°†ç»“æœå¤åˆ¶åˆ°å‰ªè´´æ¿</li>
                <li>ç‚¹å‡»"ä¸‹è½½ä¸º.inoæ–‡ä»¶"å¯ä»¥å°†ç»“æœä¿å­˜ä¸ºArduinoé¡¹ç›®æ–‡ä»¶</li>
            </ul>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            const convertBtn = document.getElementById('convertBtn');
            const resetBtn = document.getElementById('resetBtn');
            const copyBtn = document.getElementById('copyBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const hexOutput = document.getElementById('hexOutput');
            const byteInfo = document.getElementById('byteInfo');
            const originalCanvas = document.getElementById('originalCanvas');
            const customCanvas = document.getElementById('customCanvas');
            const originalSize = document.getElementById('originalSize');
            const customSize = document.getElementById('customSize');
            const arrayNameInput = document.getElementById('arrayName');
            const bitmapWidthInput = document.getElementById('bitmapWidth');
            const bitmapHeightInput = document.getElementById('bitmapHeight');
            const bytesPerRowInput = document.getElementById('bytesPerRow');
            const invertColorsCheckbox = document.getElementById('invertColors');
            const outputFullCodeCheckbox = document.getElementById('outputFullCode');
            const keepAspectRatioCheckbox = document.getElementById('keepAspectRatio');
            const presetButtons = document.querySelectorAll('.preset-btn');
            
            let originalImage = null;
            
            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
            uploadArea.addEventListener('click', () => fileInput.click());
            
            // æ‹–æ”¾åŠŸèƒ½
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.backgroundColor = '#d4edfd';
                uploadArea.style.borderColor = '#2980b9';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.backgroundColor = '#e8f4fc';
                uploadArea.style.borderColor = '#3498db';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.backgroundColor = '#e8f4fc';
                uploadArea.style.borderColor = '#3498db';
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelect(e);
                }
            });
            
            // é¢„è®¾å°ºå¯¸æŒ‰é’®
            presetButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const width = this.getAttribute('data-width');
                    const height = this.getAttribute('data-height');
                    bitmapWidthInput.value = width;
                    bitmapHeightInput.value = height;
                    
                    if (originalImage) {
                        resizeImageToCustom(originalImage);
                    }
                });
            });
            
            // å°ºå¯¸å˜åŒ–æ—¶é‡æ–°è°ƒæ•´å›¾ç‰‡
            bitmapWidthInput.addEventListener('change', function() {
                if (originalImage) {
                    resizeImageToCustom(originalImage);
                }
            });
            
            bitmapHeightInput.addEventListener('change', function() {
                if (originalImage) {
                    resizeImageToCustom(originalImage);
                }
            });
            
            // æ–‡ä»¶é€‰æ‹©å¤„ç†
            fileInput.addEventListener('change', handleFileSelect);
            
            function handleFileSelect(e) {
                const file = e.target.files[0];
                if (!file || !file.type.match('image.*')) {
                    alert('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶ï¼');
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    originalImage = new Image();
                    originalImage.onload = function() {
                        // æ˜¾ç¤ºåŸå§‹å›¾ç‰‡
                        drawImageToCanvas(originalImage, originalCanvas);
                        originalSize.textContent = `åŸå§‹å°ºå¯¸: ${originalImage.width} Ã— ${originalImage.height} åƒç´ `;
                        
                        // æ˜¾ç¤ºè°ƒæ•´åçš„è‡ªå®šä¹‰å°ºå¯¸å›¾ç‰‡
                        resizeImageToCustom(originalImage);
                        
                        convertBtn.disabled = false;
                    };
                    originalImage.src = e.target.result;
                };
                
                reader.readAsDataURL(file);
            }
            
            function drawImageToCanvas(image, canvas) {
                const ctx = canvas.getContext('2d');
                canvas.width = image.width;
                canvas.height = image.height;
                ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
            }
            
            function resizeImageToCustom(image) {
                const width = parseInt(bitmapWidthInput.value) || 64;
                const height = parseInt(bitmapHeightInput.value) || 64;
                const keepAspectRatio = keepAspectRatioCheckbox.checked;
                
                const ctx = customCanvas.getContext('2d');
                customCanvas.width = width;
                customCanvas.height = height;
                
                // æ¸…é™¤ç”»å¸ƒ
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, width, height);
                
                if (keepAspectRatio) {
                    // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼Œä¿æŒå®½é«˜æ¯”
                    const scale = Math.min(
                        width / image.width,
                        height / image.height
                    );
                    
                    const scaledWidth = image.width * scale;
                    const scaledHeight = image.height * scale;
                    
                    // å±…ä¸­ç»˜åˆ¶
                    const x = (width - scaledWidth) / 2;
                    const y = (height - scaledHeight) / 2;
                    
                    ctx.drawImage(image, x, y, scaledWidth, scaledHeight);
                } else {
                    // ç›´æ¥æ‹‰ä¼¸åˆ°æŒ‡å®šå°ºå¯¸
                    ctx.drawImage(image, 0, 0, width, height);
                }
                
                customSize.textContent = `è‡ªå®šä¹‰å°ºå¯¸: ${width} Ã— ${height} åƒç´ `;
            }
            
            // è½¬æ¢ä¸ºé»‘ç™½å›¾ç‰‡å¹¶ç”Ÿæˆåå…­è¿›åˆ¶æ•°ç»„
            convertBtn.addEventListener('click', function() {
                if (!originalImage) {
                    alert('è¯·å…ˆä¸Šä¼ å›¾ç‰‡ï¼');
                    return;
                }
                
                const width = customCanvas.width;
                const height = customCanvas.height;
                
                // è·å–è‡ªå®šä¹‰ç”»å¸ƒçš„å›¾åƒæ•°æ®
                const ctx = customCanvas.getContext('2d');
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                // è½¬æ¢ä¸ºé»‘ç™½
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    
                    // è®¡ç®—ç°åº¦å€¼
                    const gray = 0.299 * r + 0.587 * g + 0.114 * b;
                    
                    // äºŒå€¼åŒ– - ä½¿ç”¨128ä½œä¸ºé˜ˆå€¼
                    const bwValue = gray > 128 ? 255 : 0;
                    
                    data[i] = bwValue;     // çº¢è‰²é€šé“
                    data[i + 1] = bwValue; // ç»¿è‰²é€šé“
                    data[i + 2] = bwValue; // è“è‰²é€šé“
                }
                
                // å°†é»‘ç™½å›¾åƒæ•°æ®æ”¾å›canvas
                ctx.putImageData(imageData, 0, 0);
                
                // ç”Ÿæˆä½å›¾æ•°ç»„
                generateBitmapArray(imageData, width, height);
            });
            
            function generateBitmapArray(imageData, width, height) {
                const data = imageData.data;
                const arrayName = arrayNameInput.value || 'MY_BITMAP';
                const bytesPerRow = parseInt(bytesPerRowInput.value) || 16;
                const outputFullCode = outputFullCodeCheckbox.checked;
                const invertColors = invertColorsCheckbox.checked;
                
                // è®¡ç®—æ¯è¡Œçš„å­—èŠ‚æ•° (æ¯ä¸ªå­—èŠ‚8ä¸ªåƒç´ )
                const bytesPerLine = Math.ceil(width / 8);
                const totalBytes = bytesPerLine * height;
                
                // åˆ›å»ºå­—èŠ‚æ•°ç»„
                let byteArray = new Array(totalBytes).fill(0);
                
                // å°†åƒç´ è½¬æ¢ä¸ºä½å›¾æ•°æ® (æ°´å¹³æ¯åƒç´ 1ä½)
                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        const pixelIndex = (y * width + x) * 4;
                        const grayValue = data[pixelIndex]; // ä½¿ç”¨çº¢è‰²é€šé“å€¼
                        
                        // ç¡®å®šåƒç´ æ˜¯äº®(1)è¿˜æ˜¯æš—(0)
                        let bitValue = grayValue > 128 ? 1 : 0;
                        
                        // å¦‚æœåè½¬é¢œè‰²ï¼Œåˆ™ç¿»è½¬ä½å€¼
                        if (invertColors) {
                            bitValue = 1 - bitValue;
                        }
                        
                        // è®¡ç®—å­—èŠ‚ç´¢å¼•å’Œä½ä½ç½®
                        const byteIndex = y * bytesPerLine + Math.floor(x / 8);
                        const bitPosition = 7 - (x % 8); // é«˜ä½åœ¨å‰
                        
                        // è®¾ç½®ä½
                        if (bitValue) {
                            byteArray[byteIndex] |= (1 << bitPosition);
                        }
                    }
                }
                
                // è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
                let hexArray = byteArray.map(byte => `0x${byte.toString(16).padStart(2, '0').toUpperCase()}`);
                
                // æ„å»ºæ•°ç»„å­—ç¬¦ä¸²
                let arrayString = `static unsigned char ${arrayName}[] PROGMEM = {\n    `;
                
                // æ¯è¡ŒæŒ‡å®šæ•°é‡çš„å­—èŠ‚
                for (let i = 0; i < hexArray.length; i++) {
                    arrayString += hexArray[i];
                    
                    // å¦‚æœä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼Œæ·»åŠ é€—å·
                    if (i < hexArray.length - 1) {
                        arrayString += ', ';
                    }
                    
                    // æ¯è¡ŒæŒ‡å®šæ•°é‡çš„å­—èŠ‚åæ¢è¡Œ
                    if ((i + 1) % bytesPerRow === 0 && i < hexArray.length - 1) {
                        arrayString += '\n    ';
                    }
                }
                
                arrayString += '\n};';
                
                // æ˜¾ç¤ºå­—èŠ‚ä¿¡æ¯
                byteInfo.textContent = `// ${totalBytes} bytes (${width} Ã— ${height} pixels) - ä½¿ç”¨: oled.drawBitmap(0, 0, ${arrayName}, ${width}, ${height}, SSD1306_WHITE);`;
                
                // å¦‚æœé€‰æ‹©äº†è¾“å‡ºå®Œæ•´ä»£ç ï¼Œåˆ™ç”Ÿæˆå®Œæ•´Arduinoä»£ç 
                if (outputFullCode) {
                    let fullCode = `#include <Wire.h>\n#include <Adafruit_GFX.h>\n#include <Adafruit_SSD1306.h>\n\n`;
                    fullCode += arrayString;
                    fullCode += `\n\n#define SCREEN_WIDTH ${width}\n#define SCREEN_HEIGHT ${height}\n\nAdafruit_SSD1306 oled(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1);\n\nvoid setup()\n{\n  oled.begin(SSD1306_SWITCHCAPVCC, 0x3C);\n  oled.clearDisplay();\n  oled.drawBitmap(0, 0, ${arrayName}, ${width}, ${height}, SSD1306_WHITE);\n  oled.display();\n}\n\nvoid loop()\n{\n  // åœ¨æ­¤å¤„æ·»åŠ æ‚¨çš„ä»£ç \n}`;
                    
                    hexOutput.value = fullCode;
                } else {
                    hexOutput.value = arrayString;
                }
            }
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            copyBtn.addEventListener('click', function() {
                if (!hexOutput.value) {
                    alert('è¯·å…ˆç”Ÿæˆä»£ç ï¼');
                    return;
                }
                
                hexOutput.select();
                document.execCommand('copy');
                
                // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'å·²å¤åˆ¶ï¼';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            });
            
            // ä¸‹è½½ä¸º.inoæ–‡ä»¶
            downloadBtn.addEventListener('click', function() {
                if (!hexOutput.value) {
                    alert('è¯·å…ˆç”Ÿæˆä»£ç ï¼');
                    return;
                }
                
                const arrayName = arrayNameInput.value || 'MY_BITMAP';
                const fileName = outputFullCodeCheckbox.checked ? 
                    `${arrayName.toLowerCase()}.ino` : 
                    `${arrayName.toLowerCase()}.h`;
                
                const blob = new Blob([hexOutput.value], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // é‡ç½®
            resetBtn.addEventListener('click', function() {
                fileInput.value = '';
                originalImage = null;
                hexOutput.value = '';
                byteInfo.textContent = '';
                originalSize.textContent = '';
                customSize.textContent = '';
                
                const ctx1 = originalCanvas.getContext('2d');
                const ctx2 = customCanvas.getContext('2d');
                ctx1.clearRect(0, 0, originalCanvas.width, originalCanvas.height);
                ctx2.clearRect(0, 0, customCanvas.width, customCanvas.height);
                
                originalCanvas.width = 0;
                originalCanvas.height = 0;
                customCanvas.width = 64;
                customCanvas.height = 64;
                
                convertBtn.disabled = true;
            });
        });
    </script>
</body>
</html>